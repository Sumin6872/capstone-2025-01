<!-- 상단 배너 -->
<%= render 'shared/banner' %>

<!-- 메인페이지 법안 검색바 -->
<div class="home-category-search">
  <% active_tabs = parsed_active_tabs %>
  <%= render "shared/search_form",
        active_tabs: active_tabs,
        show_main_message: true %>
</div>

<!-- 실시간 검색어: 기본 숨김, 선택된 카테고리에서만 표시 -->
<div id="trendingKeywords" class="trending-keywords">
  <span class="trending-keyword-text">실시간 검색어 :</span>
  <% ["유치원", "근로조건", "복지법", "건강보험", "최저임금"].each do |keyword| %>
    <span class="keyword-bubble trending-keyword-text"><%= keyword %></span>
  <% end %>
</div>

<!-- HOT 이슈 법안 헤더 -->
<div class="hot-issue-header">
  <div class="hot-issue-bill-text">HOT 이슈 법안</div>
  <%= link_to bills_path, class: "all-issue-bill-text" do %>
    전체 법안 보러 가기
    <%= inline_svg("next", class: "all-issue-next-icon") %>
  <% end %>
</div>

<!-- HOT 이슈 캐러셀 -->
<div data-controller="carousel">
  <!-- 카드 + 화살표 (데스크탑만) -->
  <div class="hot-issue-carousel-wrapper">
    <!-- 좌측 화살표 (데스크탑 전용) -->
    <button class="hot-issue-previous-icon desktop-only"
            data-action="mousedown->carousel#startScrollLeft mouseup->carousel#stopScroll mouseleave->carousel#stopScroll"
            aria-label="이전 슬라이드">
      <%= inline_svg("previous", class: "hot-issue-arrow") %>
    </button>

    <!-- 카드 리스트 -->
    <div data-carousel-target="container" class="hot-issue-card-container" tabindex="0">
      <% @hot_bills.each do |bill| %>
        <%= link_to bill_path(bill), class: "hot-issue-card", aria: { label: "#{bill.title} 요약: #{truncate((bill.summary || '').gsub(/\A(?:제안이유 및 주요내용|제안이유)[:\s]*/, ''), length: 90)}" } do %>
          <div class="hot-issue-title"><%= bill.title %></div>

          <div class="hot-issue-header-tag">
            <div class="bill-tag-party">
              <% specific_proposer = bill.proposals.first&.specific_proposer %>
              <% if specific_proposer.is_a?(NationalAssemblyPerson) %>
                <%= specific_proposer.party_name.presence || "무소속" %>
              <% elsif specific_proposer.is_a?(GovernmentBillSponsor) %>
                정부
              <% else %>
                기타
              <% end %>
            </div>

            <div class="bill-tag-status <%= bill.status_css_class %>">
              <span class="status-emoji"><%= bill.status_emoji %></span>
              <span class="status-label"><%= bill.current_status %></span>
            </div>
          </div>

          <div class="hot-issue-bill-description">
            <%= truncate((bill.summary || "").gsub(/\A(?:제안이유 및 주요내용|제안이유)[:\s]*/, ""), length: 90) %>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- 우측 화살표 (데스크탑 전용) -->
    <button class="hot-issue-next-icon desktop-only"
            data-action="mousedown->carousel#startScrollRight mouseup->carousel#stopScroll mouseleave->carousel#stopScroll"
            aria-label="다음 슬라이드">
      <%= inline_svg("next", class: "hot-issue-arrow") %>
    </button>
  </div>

  <!-- 데스크탑 전용: dot 페이지네이션 -->
  <div class="hot-issue-pagination desktop-only">
    <% [@hot_bills.size, 5].min.times do |index| %>
      <div
        class="hot-issue-dot <%= 'active' if index == 0 %>"
        data-carousel-target="dot"
        role="button"
        tabindex="-1"
        aria-current="<%= index == 0 ? 'true' : 'false' %>"
        aria-label="슬라이드 <%= index + 1 %>">
      </div>
    <% end %>
  </div>

  <!-- 모바일 전용: 하단 컨트롤 -->
  <div class="mobile-only hot-issue-pagination">
    <!-- 페이지 카운터 -->
    <span class="hot-issue-page-counter" data-carousel-target="pageCounter">
      1 / <%= @hot_bills.size %>
    </span>

    <!-- 이전 슬라이드 -->
    <button
      class="hot-issue-previous-icon"
      data-action="click->carousel#startScrollLeft"
      aria-label="이전 슬라이드">
      <%= inline_svg("previous", class: "hot-issue-arrow") %>
    </button>

    <!-- 정지 / 재생 버튼 -->
    <button
      class="pause-line-icon"
      data-carousel-target="playPauseIcon"
      data-action="click->carousel#toggleAutoPlay"
      aria-label="자동 재생 토글">
      <%= inline_svg("pause_line", class: "pause-line-icon") %>
    </button>

    <!-- 다음 슬라이드 -->
    <button
      class="hot-issue-next-icon"
      data-action="click->carousel#startScrollRight"
      aria-label="다음 슬라이드">
      <%= inline_svg("next", class: "hot-issue-arrow") %>
    </button>
  </div>
</div>
